# Arduino-Aidlux

## 电机控制

设置电机属性命令：
> m[] s[] x[] d[]

参数说明：

* m 命令 必须

控制电机命令。参数为电机编号。

* s 参数 必须

设置电机速度。电机速度为 0 时，电机并不能瞬间停下来，会随着惯性慢慢降低速度。

* x 参数 可选

设置速度范围最大值，如果不设置该参数，那么默认设置该值为 255，如果设置过该参数，那么按照最后一次设置该值为准。该参数跟 MCU 的 PWM 分辨率相关，默认 Arduino 的 PWM 分辨率是 8 位，即 255。如果使用其他 MCU，可以选择更高的分辨率。因此 x 参数的 PWM 分辨率大小值可以选择 8 位 (255)，10 位 (1023)，12 位 (4095)，14 位 (16383)，16 位 (65535)。

* d 参数 可选

设置电机方向。0 表示停止转动，1 表示正转(顺时针旋转)，大于 2 的数值表示反转(逆时针旋转)。默认值为 1 电机正转。如果没有设置过该参数，命令里没有改参数，那么按照默认值 1 正转。如果设置过该参数，以最后一次参数值为准。如果设置参数值为 0，那么电机会抱死并停止转动，速度能最快降低为 0。

* [] 数值 必须

[] 参数值。如果不设置该值，那么该命令无效，或者该参数无效。

例子：
设置电机 1，速度为 100，速度最大值 255，电机正转。

```bash
m1 s100 x255
```

例子：
设置电机4，速度为127，速度最大值默认255，电机反转。

```bash
m4 s127 d2 
```

读取电机状态命令：
> m[] r

参数说明：

* m 命令 必须

控制电机命令。参数值为电机编号。

* [] 数值 必须

[] 参数值。如果不设置该值，那么该命令无效，或者该参数无效。

* r 参数 必须

r 是固定参数，无参数值，表示读取电机状态。

* 返回命令的格式说明

> m[] s[] sa[] sb[] x[] d[]

m[] 是电机编号

s[] sa[] sb[] 是速度大小，电机无编码器或者单路编码器测速时，s[] 参数有效，sa[]、 sb[] 参数无效。电机有双路编码器测速时，s[] 参数无效，sa[]、 sb[] 参数有效。有编码器测速时，返回的速度值是编码器测速值，没有编码器时，返回值是设置的电机PWM，并非实际速度。

x[] 是速度最大值

d[] 是电机方向

具体参数说明参考电机设置命令。

例子：
主机读取到，无编码器电机1速度为127，最大值为255，方向反转。

```bash
m1 s127 x255 d2
```

主机读取到，带AB相测速编码器的电机4速度2000，最大值4095，方向正转。

```bash
m4 sa2000 sb2000 x4095 d1
```
